{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "contexts": {
    "local": "Developer machines and sandbox containers created via setup-env.sh",
    "staging": "Shared staging / preview deployments",
    "production": "Production (Railpack/Dokploy) deployments",
    "ci": "GitHub Actions and other CI automation"
  },
  "variables": [
    {
      "key": "NODE_ENV",
      "description": "Execution mode for Node.js services.",
      "scopes": ["root", "backend", "frontend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "development",
      "example": "production",
      "notes": "Most hosting platforms inject this automatically."
    },
    {
      "key": "BACKEND_PORT",
      "description": "Port exposed by the backend during local development. setup-env.sh copies this into apps/backend/.env as PORT.",
      "scopes": ["root"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "4001",
      "example": "4001"
    },
    {
      "key": "FRONTEND_PORT",
      "description": "Port exposed by the frontend during local development. setup-env.sh copies this into apps/frontend/.env.local as PORT.",
      "scopes": ["root"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "4000",
      "example": "4000"
    },
    {
      "key": "PORT",
      "description": "Runtime port bound by the current process. Dokploy sets this per service; local development relies on BACKEND_PORT and FRONTEND_PORT.",
      "scopes": ["backend", "frontend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "example": "4001",
      "notes": "Set via your hosting provider (e.g., Dokploy). Leave unset in root .env."
    },
    {
      "key": "HOST",
      "description": "Network interface the backend binds to.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "0.0.0.0",
      "example": "0.0.0.0"
    },
    {
      "key": "LOG_LEVEL",
      "description": "Pino log level for backend services.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "info",
      "example": "debug"
    },
    {
      "key": "PRETTY_LOGS",
      "description": "Enable human-readable logs (useful locally, usually disabled in production).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "true",
      "example": "false"
    },
    {
      "key": "TRUST_PROXY",
      "description": "Enable Fastify trust proxy mode when serving behind a load balancer or reverse proxy.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "default": "true",
      "example": "true"
    },
    {
      "key": "RATE_LIMIT_MAX",
      "description": "Maximum requests per window for Fastify rate limiting.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "default": "600",
      "example": "300"
    },
    {
      "key": "RATE_LIMIT_WINDOW",
      "description": "Window for Fastify rate limiting (human-readable string).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "default": "1 minute",
      "example": "30 seconds"
    },
    {
      "key": "METRIC_PREFIX",
      "description": "Prefix applied to Prometheus metrics.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "trayb_",
      "example": "trayb_"
    },
    {
      "key": "CLUSTER_WORKERS",
      "description": "Number of Fastify cluster workers to spawn.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "1",
      "example": "4",
      "notes": "Keep at 1 until sticky sessions and /metrics protections are in place."
    },
    {
      "key": "UNDER_PRESSURE_MAX_EVENT_LOOP_DELAY",
      "description": "Under-pressure event loop threshold in milliseconds.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": true, "ci": false },
      "default": "1000",
      "example": "750"
    },
    {
      "key": "UNDER_PRESSURE_MAX_HEAP_BYTES",
      "description": "Under-pressure heap limit in bytes.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": true, "ci": false },
      "default": "268435456",
      "example": "402653184"
    },
    {
      "key": "BULLMQ_METRICS_POLL_MS",
      "description": "Polling interval for BullMQ metrics (milliseconds).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "15000",
      "example": "10000"
    },
    {
      "key": "FRONTEND_URL",
      "description": "Public URL of the frontend application (browser origin).",
      "scopes": ["shared"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4000",
      "example": "https://customs.trayb.az"
    },
    {
      "key": "FRONTEND_INTERNAL_URL",
      "description": "Internal URL for backend-to-frontend calls (Auth.js proxy).",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4000",
      "example": "http://customs-frontend-cz1cad:4000"
    },
    {
      "key": "CORS_ORIGIN",
      "description": "Allowed origin(s) for cross-site requests.",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4000",
      "example": "https://customs.trayb.az"
    },
    {
      "key": "NEXT_PUBLIC_API_URL",
      "description": "Frontend base URL used for API calls.",
      "scopes": ["frontend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4001",
      "example": "https://customs.trayb.az/",
      "notes": "Dokploy deployments may include a trailing slash; both formats are supported."
    },
    {
      "key": "NEXT_PUBLIC_APP_URL",
      "description": "Frontend public URL exposed to the browser (used by client-side routing).",
      "scopes": ["frontend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4000",
      "example": "https://customs.trayb.az"
    },
    {
      "key": "NEXTAUTH_URL",
      "description": "Canonical NextAuth URL used during callbacks.",
      "scopes": ["frontend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4000",
      "example": "https://customs.trayb.az"
    },
    {
      "key": "DATABASE_URL",
      "description": "Primary Postgres connection string.",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "example": "postgresql://postgres:password@localhost:5432/trayb_customs?schema=public",
      "notes": "Treat as a secret when pointing to managed services."
    },
    {
      "key": "REDIS_URL",
      "description": "Redis connection string.",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "example": "redis://localhost:6379",
      "notes": "Treat as a secret when pointing to managed services."
    },
    {
      "key": "JWT_SECRET",
      "description": "JWT signing secret for backend auth.",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "example": "openssl rand -base64 32",
      "notes": "Secret value. Store in Dokploy secrets and never commit."
    },
    {
      "key": "SESSION_SECRET",
      "description": "Fastify session secret.",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "example": "openssl rand -base64 32",
      "notes": "Secret value. Store in Dokploy secrets and never commit."
    },
    {
      "key": "AUTH_SECRET",
      "description": "NextAuth secret used for session encryption (shared across backend and frontend).",
      "scopes": ["backend", "frontend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "example": "openssl rand -base64 32",
      "notes": "Secret value. Must match in both backend and frontend environments."
    },
    {
      "key": "DISCORD_CLIENT_ID",
      "description": "Discord OAuth application client ID.",
      "scopes": ["shared"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "example": "1435393515545694248"
    },
    {
      "key": "DISCORD_CLIENT_SECRET",
      "description": "Discord OAuth application client secret.",
      "scopes": ["shared"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "notes": "Secret value. Rotate via Discord Developer Portal."
    },
    {
      "key": "DISCORD_REDIRECT_URI",
      "description": "Discord OAuth redirect URI.",
      "scopes": ["backend"],
      "required": { "local": true, "staging": true, "production": true, "ci": false },
      "default": "http://localhost:4001/api/core-auth/discord/callback",
      "example": "https://customs.trayb.az/api/core-auth/discord/callback"
    },
    {
      "key": "DISCORD_BOT_TOKEN",
      "description": "Discord bot token used for automated channel management.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "notes": "Secret value required in staging/production."
    },
    {
      "key": "DISCORD_GUILD_ID",
      "description": "Discord guild (server) ID monitored by the bot.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "example": "1065631647757774970"
    },
    {
      "key": "DISCORD_LOBBY_CHANNEL_ID",
      "description": "Discord channel ID for the lobby voice/text channel.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "example": "1436009958469533726"
    },
    {
      "key": "DISCORD_TEAM_ALPHA_CHANNEL_ID",
      "description": "Discord channel ID for Team Alpha.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "example": "1426994984300712027"
    },
    {
      "key": "DISCORD_TEAM_BRAVO_CHANNEL_ID",
      "description": "Discord channel ID for Team Bravo.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "example": "1426995070590255186"
    },
    {
      "key": "DISCORD_RESULTS_CHANNEL_ID",
      "description": "Discord channel ID for match result summaries.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "example": "1436464923365605426"
    },
    {
      "key": "DISCORD_ROLE_UNRANKED",
      "description": "Discord role ID used for unranked players.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_WOOD",
      "description": "Discord role ID for Wood tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_BRONZE",
      "description": "Discord role ID for Bronze tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_SILVER",
      "description": "Discord role ID for Silver tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_GOLD",
      "description": "Discord role ID for Gold tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_PLATINUM",
      "description": "Discord role ID for Platinum tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_DIAMOND",
      "description": "Discord role ID for Diamond tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_EMERALD",
      "description": "Discord role ID for Emerald tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_RUBY",
      "description": "Discord role ID for Ruby tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_ROLE_GOD",
      "description": "Discord role ID for God tier.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false }
    },
    {
      "key": "DISCORD_WHITELISTED_IDS",
      "description": "Comma-separated Discord user IDs that bypass access controls (optional).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "notes": "Leave blank to allow all authenticated Discord users."
    },
    {
      "key": "DISCORD_ROOT_IDS",
      "description": "Comma-separated Discord user IDs that should automatically receive the ROOT role on login.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "example": "492690309143330816",
      "notes": "Use sparingly. Ensure listed IDs are trusted administrators; removing an ID will not automatically demote existing ROOT users."
    },
    {
      "key": "RANDOM_ORG_API_KEY",
      "description": "Optional Random.org API key for randomness features.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "notes": "Secret value. If unset, the system falls back to Math.random()."
    },
    {
      "key": "CACHE_PROFILE_TTL",
      "description": "TTL for cached profile summaries (seconds).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "60",
      "example": "45"
    },
    {
      "key": "CACHE_PROFILE_FULL_TTL",
      "description": "TTL for cached full profile summaries (seconds).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "120",
      "example": "90"
    },
    {
      "key": "CACHE_MATCH_LIST_TTL",
      "description": "TTL for cached match lists (seconds).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "15",
      "example": "30"
    },
    {
      "key": "CACHE_MATCH_SNAPSHOT_TTL",
      "description": "TTL for cached match snapshots (seconds).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "30",
      "example": "45"
    },
    {
      "key": "SSE_HEARTBEAT_INTERVAL_MS",
      "description": "Heartbeat interval for SSE connections.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "15000",
      "example": "10000"
    },
    {
      "key": "SSE_CLIENT_QUEUE_LIMIT",
      "description": "Buffered event limit per SSE client.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "100",
      "example": "200"
    },
    {
      "key": "REALTIME_STREAM_KEY",
      "description": "Redis stream key used for realtime event fan-out.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "default": "trayb:events:realtime",
      "example": "customs:events:realtime"
    },
    {
      "key": "REALTIME_STREAM_GROUP",
      "description": "Redis stream consumer group for realtime delivery.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "default": "realtime-consumers",
      "example": "realtime-consumers"
    },
    {
      "key": "REALTIME_STREAM_MAXLEN",
      "description": "Maximum entries retained in the realtime Redis stream.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": true, "ci": false },
      "default": "5000",
      "example": "10000"
    },
    {
      "key": "REALTIME_STREAM_READ_COUNT",
      "description": "Batch size for Redis stream reads.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": true, "ci": false },
      "default": "50",
      "example": "100"
    },
    {
      "key": "REALTIME_STREAM_READ_BLOCK_MS",
      "description": "Blocking duration for Redis stream reads (milliseconds).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": true, "ci": false },
      "default": "5000",
      "example": "2000"
    },
    {
      "key": "ELO_START_RATING",
      "description": "Initial ELO rating for new players.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "800",
      "example": "800"
    },
    {
      "key": "ELO_CALIBRATION_MATCHES",
      "description": "Number of calibration matches before the normal K-factor applies.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "10",
      "example": "10"
    },
    {
      "key": "ELO_CALIBRATION_K_FACTOR",
      "description": "K-factor during calibration matches.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "48",
      "example": "48"
    },
    {
      "key": "ELO_NORMAL_K_FACTOR",
      "description": "Default K-factor after calibration.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "32",
      "example": "32"
    },
    {
      "key": "ELO_HIGH_ELO_K_FACTOR",
      "description": "K-factor applied after the high-ELO threshold.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "24",
      "example": "24"
    },
    {
      "key": "ELO_HIGH_ELO_THRESHOLD",
      "description": "ELO threshold that triggers the high-ELO K-factor.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "1600",
      "example": "1600"
    },
    {
      "key": "ELO_MAX_CHANGE_PER_SERIES",
      "description": "Maximum ELO change allowed per match series.",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "150",
      "example": "150"
    },
    {
      "key": "PROD_REPLICA_URL",
      "description": "Read-only production replica connection string used for anonymised syncs.",
      "scopes": ["backend", "scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "notes": "Populate when running scripts/db/sync-anonymized.sh."
    },
    {
      "key": "SHADOW_DATABASE_URL",
      "description": "Target database for anonymised snapshot restores.",
      "scopes": ["backend", "scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false }
    },
    {
      "key": "LOADTEST_BASE_URL",
      "description": "Base URL used by the load-testing harness.",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "http://localhost:4001",
      "example": "https://customs.trayb.az"
    },
    {
      "key": "LOADTEST_ALLOWED_HOSTS",
      "description": "Comma-separated allow list of hosts that load tests may target.",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": true, "production": true, "ci": false },
      "default": "localhost",
      "example": "localhost,staging.api.customs.trayb.az"
    },
    {
      "key": "LOADTEST_BEARER",
      "description": "Optional bearer token injected into load tests (for authenticated endpoints).",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "notes": "Secret value. Store outside of source control."
    },
    {
      "key": "LOADTEST_ALLOW_PROD",
      "description": "Explicit override to allow hitting production during load tests.",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "false"
    },
    {
      "key": "LOADTEST_CONNECTIONS",
      "description": "Override concurrent connections for load tests.",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "example": "25"
    },
    {
      "key": "LOADTEST_DURATION",
      "description": "Override duration for load tests (seconds).",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "example": "60"
    },
    {
      "key": "LOADTEST_TIMEOUT",
      "description": "Override request timeout for load tests (seconds).",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "example": "15"
    },
    {
      "key": "LOADTEST_PIPELINING",
      "description": "Override HTTP pipelining factor for load tests.",
      "scopes": ["scripts"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "example": "1"
    },
    {
      "key": "TURBO_TEAM",
      "description": "Turborepo remote cache team/namespace slug.",
      "scopes": ["ci", "deployment"],
      "required": { "local": false, "staging": false, "production": false, "ci": false }
    },
    {
      "key": "TURBO_API",
      "description": "Turborepo remote cache API endpoint.",
      "scopes": ["ci", "deployment"],
      "required": { "local": false, "staging": false, "production": false, "ci": false }
    },
    {
      "key": "TURBO_TOKEN",
      "description": "Authentication token for Turborepo remote cache.",
      "scopes": ["ci", "deployment"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "notes": "Secret value. Configure via CI/CD secret manager."
    },
    {
      "key": "TURBO_REMOTE_CACHE_SIGNATURE_KEY",
      "description": "Signature key used to verify Turborepo remote cache artefacts.",
      "scopes": ["ci", "deployment"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "notes": "Secret value."
    },
    {
      "key": "DEBUG_OPGG_HTML",
      "description": "Dump raw OPGG HTML during stat imports (debug only).",
      "scopes": ["backend"],
      "required": { "local": false, "staging": false, "production": false, "ci": false },
      "default": "false"
    }
  ]
}

